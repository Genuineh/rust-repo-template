repos:
  - repo: local
    hooks:
      - id: rust-fmt
        name: rustfmt
        entry: bash -lc "cargo fmt --all -- --check"
        language: system
        files: "\\.rs$"
      - id: rust-clippy
        name: clippy
        entry: bash -lc "\
          ALLOW_LIST=$(grep -Po '(?<=allow\s*=\s*\[).*(?=\])' clippy.toml || true) && \
          ALLOW_FLAGS=\"\" && \
          for a in $(echo \"$ALLOW_LIST\" | sed 's/,/ /g' | tr -d '"') ; do \
            if [ -n \"$a\" ]; then ALLOW_FLAGS=\"$ALLOW_FLAGS -A $a\" ; fi ; \
          done && \
          cargo clippy --all-targets --all-features -- -D warnings $ALLOW_FLAGS"
        language: system
        files: "\\.rs$"
